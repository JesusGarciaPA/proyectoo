<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Análisis</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
</head>
<body>
<div class="container">
    <div class="b_navegacion">
        <ul>
            <li><a href="diagrama" style="font-family: Tahoma; color: #FFFFFF; font-weight: bold;">Diagrama de Venn</a></li>
            <li><a href="modelo" style="font-family: Tahoma; color: #FFFFFF; font-weight: bold;">Modelo Entidad-Relación</a></li>
        </ul>
    </div>
    <br><br><br>
    <h1 style="font-family: Tahoma; color: #000000; font-weight: bold; text-align: center; font-weight: bold; font-size: 30px;">Análisis Estadístico</h1>

    <input style="font-family: Tahoma; color: #000000; font-size: 23px;" type="file" id="archivoInput" accept=".xlsx" required>

    <br>

    <label style="font-family: Tahoma; color: #000000; font-size: 23px;" for="columna">Nombre de la columna para calcular la suma:</label>
    <input type="text" id="nombreColumna" required>

    <br>

    <button onclick="calcularEstadisticas()">Calcular</button>

    <h3 style="font-family: Tahoma; color: #000000; font-weight: bold;  font-size: 23px;">Contenido del Archivo:</h3>
    <pre id="contenidoArchivo" style="font-family: Tahoma; color: #000000; font-weight: bold;"></pre>

    <div class="cont_cards">
        <p id="sumaResultado" style="font-family: Tahoma; color: #000000; font-weight: bold; text-align: center; font-size: 25px;"></p>
        <p id="mediaResultado" style="font-family: Tahoma; color: #000000; font-weight: bold; text-align: center; font-size: 25px;"></p>
        <p id="modaResultado" style="font-family: Tahoma; color: #000000; font-weight: bold; text-align: center; font-size: 25px;"></p>
        <p id="medianaResultado" style="font-family: Tahoma; color: #000000; font-weight: bold; text-align: center; font-size: 25px;"></p>
    </div>

    <script>
        function calcularEstadisticas() {
            var archivoInput = document.getElementById("archivoInput");
            var nombreColumna = document.getElementById("nombreColumna").value;

            if (archivoInput.files.length === 0) {
                alert("No se ha proporcionado ningún archivo.");
                return;
            }

            var archivo = archivoInput.files[0];

            if (!archivo.name.endsWith(".xlsx")) {
                alert("El archivo debe ser de tipo Excel (.xlsx).");
                return;
            }

            if (nombreColumna === "") {
                alert("Ingrese un nombre de columna para calcular estadísticas.");
                return;
            }

            var reader = new FileReader();

            reader.onload = function (e) {
                var contenidoArchivo = e.target.result;
                var workbook = XLSX.read(contenidoArchivo, { type: "binary" });
                var sheetName = workbook.SheetNames[0];
                var sheet = workbook.Sheets[sheetName];
                var data = XLSX.utils.sheet_to_json(sheet);

                // Muestra los datos del archivo en formato JSON de manera más legible
                document.getElementById("contenidoArchivo").innerHTML = JSON.stringify(data, null, 2);

                var columnData = data.map(row => row[nombreColumna]);
                var suma = columnData.reduce((acc, val) => acc + val, 0);
                var media = suma / columnData.length;
                var moda = calcularModa(columnData);
                var mediana = calcularMediana(columnData);

                document.getElementById("sumaResultado").innerHTML = "La suma de la columna es: " + suma;
                document.getElementById("mediaResultado").innerHTML = "La media de la columna es: " + media;

                if (moda.length > 0) {
                    document.getElementById("modaResultado").innerHTML = "La moda de la columna es: " + moda.join(", ");
                } else {
                    document.getElementById("modaResultado").innerHTML = "No hay moda en la columna.";
                }

                document.getElementById("medianaResultado").innerHTML = "La mediana de la columna es: " + mediana;
            };

            reader.readAsBinaryString(archivo);
        }

        function calcularModa(data) {
            var frequency = {};
            var maxFreq = 0;
            var moda = [];

            data.forEach(function (value) {
                frequency[value] = (frequency[value] || 0) + 1;
                if (frequency[value] > maxFreq) {
                    maxFreq = frequency[value];
                    moda = [value];
                } else if (frequency[value] === maxFreq && moda.indexOf(value) === -1) {
                    moda.push(value);
                }
            });

            return moda;
        }

        function calcularMediana(data) {
            data.sort(function (a, b) {
                return a - b;
            });

            var middle = Math.floor(data.length / 2);

            if (data.length % 2 === 0) {
                return (data[middle - 1] + data[middle]) / 2;
            } else {
                return data[middle];
            }
        }
    </script>
</div>
</body>
</html>
